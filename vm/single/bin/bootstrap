#!/bin/bash

release=$1

if [[ -f $HOME/.bootstrapped ]]; then
  exit 0
fi

echo INSTALLING CURL
sudo aptitude install -y curl linux-image-extra-`uname -r`

echo INSTALLING puppetlabs-release-${release}
curl -sO http://apt.puppetlabs.com/puppetlabs-release-${release}.deb
sudo dpkg -i puppetlabs-release-${release}.deb

echo INSTALLING /etc/apt/sources.list.d/docker.list
echo deb http://get.docker.io/ubuntu docker main | sudo tee /etc/apt/sources.list.d/docker.list

echo INSTALLING /etc/apt/sources.list.d/elasticsearch.list
echo deb http://packages.elasticsearch.org/elasticsearch/0.90/debian stable main \
  | sudo tee /etc/apt/sources.list.d/elasticsearch.list

echo INSTALLING apt-key
curl -s http://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -
curl -s https://get.docker.io/gpg | sudo apt-key add -

echo UPDATING
sudo aptitude update

echo INSTALLING remaining packages
sudo aptitude install -y puppet facter lxc-docker
#sudo puppet module install --force puppetlabs/stdlib
#sudo puppet module install --force puppetlabs/vcsrepo

sudo sh -c "echo 192.168.56.1 puppet.local.raines.me puppet >>/etc/hosts"

touch $HOME/bootstrapped
